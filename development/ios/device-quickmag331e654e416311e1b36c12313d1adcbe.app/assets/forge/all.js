/*! Copyright 2011 Trigger Corp. All rights reserved. */
(function(){var m={};m.config={browser_action:{default_popup:"index.html",default_icon:"img/apple-touch-icon.png"},logging:{level:"INFO"},uuid:"331e654e416311e1b36c12313d1adcbe",version:"0.1",name:"QuickMag"};var n={};n.listeners={};var p={};var h=[];var g=null;var a=false;var r=function(){if(h.length>0){if(!window.forge.debug||window.catalystConnected){a=true;while(h.length>0){var s=h.shift();if(s[0]=="logging.log"){console.log(s[1].message)}n.priv.call.apply(n.priv,s)}a=false}else{g=setTimeout(r,500)}}};n.priv={call:function(x,w,v,t){if((!window.forge.debug||window.catalystConnected)&&(h.length==0||a)){var s=m.tools.UUID();var u=true;if(x==="button.onClicked.addListener"||x==="message.toFocussed"){u=false}if(v||t){p[s]={success:v,error:t,onetime:u}}n.priv.send({callid:s,method:x,params:w})}else{h.push(arguments);if(!g){g=setTimeout(r,500)}}},send:function(s){throw new Error("Forge error: missing bridge to privileged code")},receive:function(s){if(s.callid){if(typeof p[s.callid]===undefined){m.log("Nothing stored for call ID: "+s.callid)}var u=p[s.callid];var t=(typeof s.content==="undefined"?null:s.content);if(u&&u[s.status]){u[s.status](s.content)}if(u&&u.onetime){delete p[s.callid]}}else{if(s.event){if(n.listeners[s.event]){n.listeners[s.event].forEach(function(v){v()})}}}}};n.generateQueryString=function(s){if(typeof s==="string"){return s}var t="";for(key in s){t+=encodeURIComponent(key)+"="+encodeURIComponent(s[key])+"&"}return t.substring(0,t.length-1)};n.generateMultipartString=function(s,u){if(typeof s==="string"){return""}var t="";for(key in s){t+="--"+u+"\r\n";t+='Content-Disposition: form-data; name="'+key.replace('"','\\"')+'"\r\n\r\n';t+=s[key].toString()+"\r\n"}return t},n.generateURI=function(t,s){var u="";if(t.indexOf("?")!==-1){u+=t.split("?")[1]+"&";t=t.split("?")[0]}u+=this.generateQueryString(s)+"&";u=u.substring(0,u.length-1);return t+(u?"?"+u:"")};m.is={mobile:function(){return false},desktop:function(){return false},android:function(){return false},ios:function(){return false},chrome:function(){return false},firefox:function(){return false},safari:function(){return false},ie:function(){return false}};m.button={setIcon:function(t,u,s){n.priv.call("button.setIcon",t,u,s)},setURL:function(t,u,s){n.priv.call("button.setURL",t,u,s)},onClicked:{addListener:function(s){n.priv.call("button.onClicked.addListener",null,s)}},setBadge:function(t,u,s){n.priv.call("button.setBadge",t,u,s)},setBadgeBackgroundColor:function(t,u,s){n.priv.call("button.setBadgeBackgroundColor",t,u,s)},setTitle:function(u,t,s){n.priv.call("button.setTitle",u,t,s)}};m.message={listen:function(t,u,s){s&&s({message:"Forge Error: message.listen must be overridden by platform specific code"})},broadcast:function(t,u,v,s){s&&s({message:"Forge Error: message.broadcast must be overridden by platform specific code"})},broadcastBackground:function(t,u,v,s){s&&s({message:"Forge Error: message.broadcastBackground must be overridden by platform specific code"})},toFocussed:function(t,u,v,s){n.priv.call("message.toFocussed",{type:t,content:u},v,s)}};m.notification={create:function(v,u,t,s){n.priv.call("notification.create",{title:v,text:u},t,s)}};m.request={get:function(t,u,s){m.request.ajax({url:t,dataType:"text",success:u&&function(){try{arguments[0]=JSON.parse(arguments[0])}catch(v){}u.apply(this,arguments)},error:s})},ajax:function(u){var s=u.dataType;if(s=="xml"){u.dataType="text"}var v=u.success&&function(y){try{if(s=="xml"){var x,w;if(window.DOMParser){x=new DOMParser();w=x.parseFromString(y,"text/xml")}else{w=new ActiveXObject("Microsoft.XMLDOM");w.async="false";w.loadXML(y)}y=w}}catch(z){}u.success&&u.success(y)};var t=u.error&&function(w){if(w.status=="error"&&!w.err){m.logging.log("AJAX request to "+u.url+" failed, have you included that url in the permissions section of the config file for this app?")}u.error&&u.error(w)};n.priv.call("request.ajax",u,v,t)}};m.tools={UUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var t=Math.random()*16|0;var s=u=="x"?t:(t&3|8);return s.toString(16)}).toUpperCase()},getURL:function(t,u,s){n.priv.call("tools.getURL",{name:t.toString()},u,s)}};var i=function(y,w,z){var u=[];stylize=function(B,A){return B};function s(A){return A instanceof RegExp||(typeof A==="object"&&Object.prototype.toString.call(A)==="[object RegExp]")}function t(A){return A instanceof Array||Array.isArray(A)||(A&&A!==Object.prototype&&t(A.__proto__))}function v(C){if(C instanceof Date){return true}if(typeof C!=="object"){return false}var A=Date.prototype&&Object.getOwnPropertyNames(Date.prototype);var B=C.__proto__&&Object.getOwnPropertyNames(C.__proto__);return JSON.stringify(B)===JSON.stringify(A)}function x(M,J){try{if(M&&typeof M.inspect==="function"&&M!==exports&&!(M.constructor&&M.constructor.prototype===M)){return M.inspect(J)}switch(typeof M){case"undefined":return stylize("undefined","undefined");case"string":var A="'"+JSON.stringify(M).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return stylize(A,"string");case"number":return stylize(""+M,"number");case"boolean":return stylize(""+M,"boolean")}if(M===null){return stylize("null","null")}if(M instanceof Document){return(new XMLSerializer()).serializeToString(M)}var G=Object.keys(M);var N=w?Object.getOwnPropertyNames(M):G;if(typeof M==="function"&&N.length===0){var B=M.name?": "+M.name:"";return stylize("[Function"+B+"]","special")}if(s(M)&&N.length===0){return stylize(""+M,"regexp")}if(v(M)&&N.length===0){return stylize(M.toUTCString(),"date")}var C,K,H;if(t(M)){K="Array";H=["[","]"]}else{K="Object";H=["{","}"]}if(typeof M==="function"){var F=M.name?": "+M.name:"";C=" [Function"+F+"]"}else{C=""}if(s(M)){C=" "+M}if(v(M)){C=" "+M.toUTCString()}if(N.length===0){return H[0]+C+H[1]}if(J<0){if(s(M)){return stylize(""+M,"regexp")}else{return stylize("[Object]","special")}}u.push(M);var E=N.map(function(P){var O,Q;if(M.__lookupGetter__){if(M.__lookupGetter__(P)){if(M.__lookupSetter__(P)){Q=stylize("[Getter/Setter]","special")}else{Q=stylize("[Getter]","special")}}else{if(M.__lookupSetter__(P)){Q=stylize("[Setter]","special")}}}if(G.indexOf(P)<0){O="["+P+"]"}if(!Q){if(u.indexOf(M[P])<0){if(J===null){Q=x(M[P])}else{Q=x(M[P],J-1)}if(Q.indexOf("\n")>-1){if(t(M)){Q=Q.split("\n").map(function(R){return"  "+R}).join("\n").substr(2)}else{Q="\n"+Q.split("\n").map(function(R){return"   "+R}).join("\n")}}}else{Q=stylize("[Circular]","special")}}if(typeof O==="undefined"){if(K==="Array"&&P.match(/^\d+$/)){return Q}O=JSON.stringify(""+P);if(O.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){O=O.substr(1,O.length-2);O=stylize(O,"name")}else{O=O.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");O=stylize(O,"string")}}return O+": "+Q});u.pop();var L=0;var D=E.reduce(function(O,P){L++;if(P.indexOf("\n")>=0){L++}return O+P.length+1},0);if(D>50){E=H[0]+(C===""?"":C+"\n ")+" "+E.join(",\n  ")+" "+H[1]}else{E=H[0]+C+" "+E.join(", ")+" "+H[1]}return E}catch(I){return"[No string representation]"}}return x(y,(typeof z==="undefined"?2:z))};var b=function(t){if("logging" in m.config){var s=m.config.logging.marker||"FORGE"}else{var s="FORGE"}t="["+s+"] "+(t.indexOf("\n")===-1?"":"\n")+t;n.priv.call("logging.log",{message:t,error:null});if(typeof console!=="undefined"&&typeof console.log!=="undefined"&&!(console.log.toString&&console.log.toString().match("alert"))){console.log(t)}};var l=function(s,t){if(s in m.logging.LEVELS){return m.logging.LEVELS[s]}else{m.logging.__logMessage("Unknown configured logging level: "+s);return t}};var q=function(t){var w=function(x){if(x.message){return x.message}else{if(x.description){return x.description}else{return""+x}}};if(t){var v="\nError: "+w(t);try{if(t.lineNumber){v+=" on line number "+t.lineNumber}if(t.fileName){var s=t.fileName;v+=" in file "+s.substr(s.lastIndexOf("/")+1)}}catch(u){}if(t.stack){v+="\r\nStack trace:\r\n"+t.stack}return v}return""};m.logging={LEVELS:{ALL:0,DEBUG:10,INFO:20,WARNING:30,ERROR:40,CRITICAL:50},debug:function(t,s){m.logging.log(t,s,m.logging.LEVELS.DEBUG)},info:function(t,s){m.logging.log(t,s,m.logging.LEVELS.INFO)},warning:function(t,s){m.logging.log(t,s,m.logging.LEVELS.WARNING)},error:function(t,s){m.logging.log(t,s,m.logging.LEVELS.ERROR)},critical:function(t,s){m.logging.log(t,s,m.logging.LEVELS.CRITICAL)},log:function(t,s,w){if(typeof(w)==="undefined"){var w=m.logging.LEVELS.ERROR}try{var u=l(m.config.logging.level,m.logging.LEVELS.ALL)}catch(v){var u=m.logging.LEVELS.ALL}if(w>=u){b(i(t)+q(s))}}};m.tabs={open:function(t,u,v,s){if(typeof u==="function"){s=v;v=u;u=false}n.priv.call("tabs.open",{url:t,keepFocus:u},v,s)},closeCurrent:function(s){s=arguments[1]||s;var t=m.tools.UUID();location.hash=t;n.priv.call("tabs.closeCurrent",{hash:t},null,s)}};m.prefs={get:function(t,u,s){n.priv.call("prefs.get",{key:t.toString()},u&&function(v){if(v==="undefined"){v=undefined}else{try{v=JSON.parse(v)}catch(w){s({message:w.toString()});return}}u(v)},s)},set:function(t,u,v,s){if(u===undefined){u="undefined"}else{u=JSON.stringify(u)}n.priv.call("prefs.set",{key:t.toString(),value:u},v,s)},keys:function(t,s){n.priv.call("prefs.keys",{},t,s)},all:function(t,s){var t=t&&function(u){for(key in u){if(u[key]==="undefined"){u[key]=undefined}else{u[key]=JSON.parse(u[key])}}t(u)};n.priv.call("prefs.all",{},t,s)},clear:function(t,u,s){n.priv.call("prefs.clear",{key:t.toString()},u,s)},clearAll:function(t,s){n.priv.call("prefs.clearAll",{},t,s)}};m.file={getImage:function(t,s){n.priv.call("file.getImage",{},function(u){t&&t({uri:u,name:"Image"})},s)},base64:function(t,u,s){n.priv.call("file.base64",t,u,s)},imageBase64:function(t,u,v,s){if(typeof u==="function"){s=v;v=u}u=u||{};u.height=u.height||0;u.width=u.width||0;n.priv.call("file.imageBase64",{file:t,props:u},v,s)},imageURL:function(t,u,v,s){if(typeof u==="function"){s=v;v=u}if(t.uri){v(t.uri)}else{s()}},isImage:function(t,u,s){n.priv.call("file.isImage",t,u,s)},isFile:function(t,u,s){n.priv.call("file.isFile",t,u,s)}};m.event={menuPressed:{addListener:function(t,s){if(n.listeners.menuPressed){n.listeners.menuPressed.push(t)}else{n.listeners.menuPressed=[t]}}}};m.contact={select:function(t,s){n.priv.call("contact.select",{},t,s)}};var e=[];var k="zero-timeout-message";function c(s){e.push(s);window.postMessage(k,"*");return true}function d(t){if(t.source==window&&t.data==k){t.stopPropagation();if(e.length>0){var s=e.shift();s()}}}window.addEventListener("message",d,true);var o=[];var j;var f=false;n.priv.get=function(){var s=o;o=[];return JSON.stringify(s)};n.priv.send=function(s){o.push(s);if(f&&!j){j=c(function(){window.location.href="forge://go";j=undefined})}};document.addEventListener("DOMContentLoaded",function(){f=true;j=setTimeout(function(){window.location.href="forge://go";j=undefined},0)},false);m.is.mobile=function(){return true};m.is.ios=function(){return true};m.request.ajax=function(H){var u=(H.files?H.files:null);var v=(H.url?H.url:null);var G=(H.success?H.success:undefined);var B=(H.error?H.error:undefined);var z=(H.username?H.username:null);var F=(H.password?H.password:null);var t=(H.accepts?H.accepts:["*/*"]);var s=(H.cache?H.cache:false);var E=(H.contentType?H.contentType:null);var y=(H.data?H.data:null);var D=(H.dataType?H.dataType:null);var x=(H.headers?H.headers:{});var C=(H.timeout?H.timeout/1000:60);var A=(H.type?H.type:"GET");if(typeof t==="string"){t=[t]}var w=null;if(u){w=m.tools.UUID().replace(/-/g,"");y=n.generateMultipartString(y,w);E="multipart/form-data; boundary="+w}else{if(A=="GET"){v=n.generateURI(v,y);y=null}else{if(y){y=n.generateQueryString(y);if(!E){E="application/x-www-form-urlencoded"}}}}if(s){s={};s["wm"+Math.random()]=Math.random();v=n.generateURI(v,s)}if(t){x.Accept=t.join(",")}if(E){x["Content-Type"]=E}n.priv.call("request.ajax",{url:v,username:z,password:F,data:y,headers:x,timeout:C,type:A,boundary:w,files:u},G&&function(K){try{if(D=="xml"){var J,I;if(window.DOMParser){J=new DOMParser();I=J.parseFromString(K,"text/xml")}else{I=new ActiveXObject("Microsoft.XMLDOM");I.async="false";I.loadXML(K)}K=I}else{if(D=="json"){K=JSON.parse(K)}}}catch(L){}G(K)},B)};m.file.imageURL=function(t,u,v,s){if(typeof u==="function"){s=v;v=u}u=u||{};u.height=u.height||0;u.width=u.width||0;n.priv.call("file.imageURL",{file:t,props:u},v,s)};window.forge={config:m.config,is:{mobile:m.is.mobile,desktop:m.is.desktop,android:m.is.android,ios:m.is.ios,chrome:m.is.chrome,firefox:m.is.firefox,safari:m.is.safari,ie:m.is.ie},message:{listen:m.message.listen,broadcast:m.message.broadcast,broadcastBackground:m.message.broadcastBackground,toFocussed:m.message.toFocussed},notification:{create:m.notification.create},request:{get:m.request.get,ajax:m.request.ajax},logging:{log:m.logging.log,debug:m.logging.debug,info:m.logging.info,warning:m.logging.warning,error:m.logging.error,critical:m.logging.critical},tabs:{open:m.tabs.open,closeCurrent:m.tabs.closeCurrent},tools:{UUID:m.tools.UUID,getURL:m.tools.getURL},prefs:{get:m.prefs.get,set:m.prefs.set,clear:m.prefs.clear,clearAll:m.prefs.clearAll,keys:m.prefs.keys},button:{setIcon:m.button.setIcon,setURL:m.button.setURL,onClicked:{addListener:m.button.onClicked.addListener},setBadge:m.button.setBadge,setBadgeBackgroundColor:m.button.setBadgeBackgroundColor,setTitle:m.button.setTitle},file:{getImage:m.file.getImage,isFile:m.file.isFile,isImage:m.file.isImage,imageURL:m.file.imageURL,imageBase64:m.file.imageBase64,base64:m.file.base64},event:{menuPressed:{addListener:m.event.menuPressed.addListener}},contact:{select:m.contact.select}};window.forge["ajax"]=m.request.ajax;window.forge["getPage"]=m.request.get;window.forge["createNotification"]=m.notification.create;window.forge["UUID"]=m.tools.UUID;window.forge["getURL"]=m.tools.getURL;window.forge["log"]=m.logging.log;window.forge["button"]["setUrl"]=m.button.setURL;window.forge["button"]["setBadgeText"]=m.button.setBadge;window.forge["_get"]=n.priv.get;window.forge["_receive"]=n.priv.receive;window.forge["_dispatchMessage"]=n.dispatchMessage})();