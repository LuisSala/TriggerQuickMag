/*! Copyright 2011 Trigger Corp. All rights reserved. */
(function(){var j={};j.config={browser_action:{default_popup:"index.html",default_icon:"img/apple-touch-icon.png"},logging:{level:"INFO"},uuid:"331e654e416311e1b36c12313d1adcbe",version:"0.1",name:"QuickMag"};var g={};g.listeners={};var c={};var f=[];var e=null;var i=false;var k=function(){if(f.length>0){if(!window.forge.debug||window.catalystConnected){i=true;while(f.length>0){var l=f.shift();if(l[0]=="logging.log"){console.log(l[1].message)}g.priv.call.apply(g.priv,l)}i=false}else{e=setTimeout(k,500)}}};g.priv={call:function(q,p,o,m){if((!window.forge.debug||window.catalystConnected)&&(f.length==0||i)){var l=j.tools.UUID();var n=true;if(q==="button.onClicked.addListener"||q==="message.toFocussed"){n=false}if(o||m){c[l]={success:o,error:m,onetime:n}}g.priv.send({callid:l,method:q,params:p})}else{f.push(arguments);if(!e){e=setTimeout(k,500)}}},send:function(l){throw new Error("Forge error: missing bridge to privileged code")},receive:function(l){if(l.callid){if(typeof c[l.callid]===undefined){j.log("Nothing stored for call ID: "+l.callid)}var n=c[l.callid];var m=(typeof l.content==="undefined"?null:l.content);if(n&&n[l.status]){n[l.status](l.content)}if(n&&n.onetime){delete c[l.callid]}}else{if(l.event){if(g.listeners[l.event]){g.listeners[l.event].forEach(function(o){o()})}}}}};g.generateQueryString=function(l){if(typeof l==="string"){return l}var m="";for(key in l){m+=encodeURIComponent(key)+"="+encodeURIComponent(l[key])+"&"}return m.substring(0,m.length-1)};g.generateMultipartString=function(l,n){if(typeof l==="string"){return""}var m="";for(key in l){m+="--"+n+"\r\n";m+='Content-Disposition: form-data; name="'+key.replace('"','\\"')+'"\r\n\r\n';m+=l[key].toString()+"\r\n"}return m},g.generateURI=function(m,l){var n="";if(m.indexOf("?")!==-1){n+=m.split("?")[1]+"&";m=m.split("?")[0]}n+=this.generateQueryString(l)+"&";n=n.substring(0,n.length-1);return m+(n?"?"+n:"")};j.is={mobile:function(){return false},desktop:function(){return false},android:function(){return false},ios:function(){return false},chrome:function(){return false},firefox:function(){return false},safari:function(){return false},ie:function(){return false}};j.button={setIcon:function(m,n,l){g.priv.call("button.setIcon",m,n,l)},setURL:function(m,n,l){g.priv.call("button.setURL",m,n,l)},onClicked:{addListener:function(l){g.priv.call("button.onClicked.addListener",null,l)}},setBadge:function(m,n,l){g.priv.call("button.setBadge",m,n,l)},setBadgeBackgroundColor:function(m,n,l){g.priv.call("button.setBadgeBackgroundColor",m,n,l)},setTitle:function(n,m,l){g.priv.call("button.setTitle",n,m,l)}};j.message={listen:function(m,n,l){l&&l({message:"Forge Error: message.listen must be overridden by platform specific code"})},broadcast:function(m,n,o,l){l&&l({message:"Forge Error: message.broadcast must be overridden by platform specific code"})},broadcastBackground:function(m,n,o,l){l&&l({message:"Forge Error: message.broadcastBackground must be overridden by platform specific code"})},toFocussed:function(m,n,o,l){g.priv.call("message.toFocussed",{type:m,content:n},o,l)}};j.notification={create:function(o,n,m,l){g.priv.call("notification.create",{title:o,text:n},m,l)}};j.request={get:function(m,n,l){j.request.ajax({url:m,dataType:"text",success:n&&function(){try{arguments[0]=JSON.parse(arguments[0])}catch(o){}n.apply(this,arguments)},error:l})},ajax:function(n){var l=n.dataType;if(l=="xml"){n.dataType="text"}var o=n.success&&function(r){try{if(l=="xml"){var q,p;if(window.DOMParser){q=new DOMParser();p=q.parseFromString(r,"text/xml")}else{p=new ActiveXObject("Microsoft.XMLDOM");p.async="false";p.loadXML(r)}r=p}}catch(s){}n.success&&n.success(r)};var m=n.error&&function(p){if(p.status=="error"&&!p.err){j.logging.log("AJAX request to "+n.url+" failed, have you included that url in the permissions section of the config file for this app?")}n.error&&n.error(p)};g.priv.call("request.ajax",n,o,m)}};j.tools={UUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var m=Math.random()*16|0;var l=n=="x"?m:(m&3|8);return l.toString(16)}).toUpperCase()},getURL:function(m,n,l){g.priv.call("tools.getURL",{name:m.toString()},n,l)}};var d=function(r,p,s){var n=[];stylize=function(u,t){return u};function l(t){return t instanceof RegExp||(typeof t==="object"&&Object.prototype.toString.call(t)==="[object RegExp]")}function m(t){return t instanceof Array||Array.isArray(t)||(t&&t!==Object.prototype&&m(t.__proto__))}function o(v){if(v instanceof Date){return true}if(typeof v!=="object"){return false}var t=Date.prototype&&Object.getOwnPropertyNames(Date.prototype);var u=v.__proto__&&Object.getOwnPropertyNames(v.__proto__);return JSON.stringify(u)===JSON.stringify(t)}function q(F,C){try{if(F&&typeof F.inspect==="function"&&F!==exports&&!(F.constructor&&F.constructor.prototype===F)){return F.inspect(C)}switch(typeof F){case"undefined":return stylize("undefined","undefined");case"string":var t="'"+JSON.stringify(F).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return stylize(t,"string");case"number":return stylize(""+F,"number");case"boolean":return stylize(""+F,"boolean")}if(F===null){return stylize("null","null")}if(F instanceof Document){return(new XMLSerializer()).serializeToString(F)}var z=Object.keys(F);var G=p?Object.getOwnPropertyNames(F):z;if(typeof F==="function"&&G.length===0){var u=F.name?": "+F.name:"";return stylize("[Function"+u+"]","special")}if(l(F)&&G.length===0){return stylize(""+F,"regexp")}if(o(F)&&G.length===0){return stylize(F.toUTCString(),"date")}var v,D,A;if(m(F)){D="Array";A=["[","]"]}else{D="Object";A=["{","}"]}if(typeof F==="function"){var y=F.name?": "+F.name:"";v=" [Function"+y+"]"}else{v=""}if(l(F)){v=" "+F}if(o(F)){v=" "+F.toUTCString()}if(G.length===0){return A[0]+v+A[1]}if(C<0){if(l(F)){return stylize(""+F,"regexp")}else{return stylize("[Object]","special")}}n.push(F);var x=G.map(function(I){var H,J;if(F.__lookupGetter__){if(F.__lookupGetter__(I)){if(F.__lookupSetter__(I)){J=stylize("[Getter/Setter]","special")}else{J=stylize("[Getter]","special")}}else{if(F.__lookupSetter__(I)){J=stylize("[Setter]","special")}}}if(z.indexOf(I)<0){H="["+I+"]"}if(!J){if(n.indexOf(F[I])<0){if(C===null){J=q(F[I])}else{J=q(F[I],C-1)}if(J.indexOf("\n")>-1){if(m(F)){J=J.split("\n").map(function(K){return"  "+K}).join("\n").substr(2)}else{J="\n"+J.split("\n").map(function(K){return"   "+K}).join("\n")}}}else{J=stylize("[Circular]","special")}}if(typeof H==="undefined"){if(D==="Array"&&I.match(/^\d+$/)){return J}H=JSON.stringify(""+I);if(H.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){H=H.substr(1,H.length-2);H=stylize(H,"name")}else{H=H.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");H=stylize(H,"string")}}return H+": "+J});n.pop();var E=0;var w=x.reduce(function(H,I){E++;if(I.indexOf("\n")>=0){E++}return H+I.length+1},0);if(w>50){x=A[0]+(v===""?"":v+"\n ")+" "+x.join(",\n  ")+" "+A[1]}else{x=A[0]+v+" "+x.join(", ")+" "+A[1]}return x}catch(B){return"[No string representation]"}}return q(r,(typeof s==="undefined"?2:s))};var h=function(m){if("logging" in j.config){var l=j.config.logging.marker||"FORGE"}else{var l="FORGE"}m="["+l+"] "+(m.indexOf("\n")===-1?"":"\n")+m;g.priv.call("logging.log",{message:m,error:null});if(typeof console!=="undefined"&&typeof console.log!=="undefined"&&!(console.log.toString&&console.log.toString().match("alert"))){console.log(m)}};var a=function(l,m){if(l in j.logging.LEVELS){return j.logging.LEVELS[l]}else{j.logging.__logMessage("Unknown configured logging level: "+l);return m}};var b=function(m){var p=function(q){if(q.message){return q.message}else{if(q.description){return q.description}else{return""+q}}};if(m){var o="\nError: "+p(m);try{if(m.lineNumber){o+=" on line number "+m.lineNumber}if(m.fileName){var l=m.fileName;o+=" in file "+l.substr(l.lastIndexOf("/")+1)}}catch(n){}if(m.stack){o+="\r\nStack trace:\r\n"+m.stack}return o}return""};j.logging={LEVELS:{ALL:0,DEBUG:10,INFO:20,WARNING:30,ERROR:40,CRITICAL:50},debug:function(m,l){j.logging.log(m,l,j.logging.LEVELS.DEBUG)},info:function(m,l){j.logging.log(m,l,j.logging.LEVELS.INFO)},warning:function(m,l){j.logging.log(m,l,j.logging.LEVELS.WARNING)},error:function(m,l){j.logging.log(m,l,j.logging.LEVELS.ERROR)},critical:function(m,l){j.logging.log(m,l,j.logging.LEVELS.CRITICAL)},log:function(m,l,p){if(typeof(p)==="undefined"){var p=j.logging.LEVELS.ERROR}try{var n=a(j.config.logging.level,j.logging.LEVELS.ALL)}catch(o){var n=j.logging.LEVELS.ALL}if(p>=n){h(d(m)+b(l))}}};j.tabs={open:function(m,n,o,l){if(typeof n==="function"){l=o;o=n;n=false}g.priv.call("tabs.open",{url:m,keepFocus:n},o,l)},closeCurrent:function(l){l=arguments[1]||l;var m=j.tools.UUID();location.hash=m;g.priv.call("tabs.closeCurrent",{hash:m},null,l)}};j.prefs={get:function(m,n,l){g.priv.call("prefs.get",{key:m.toString()},n&&function(o){if(o==="undefined"){o=undefined}else{try{o=JSON.parse(o)}catch(p){l({message:p.toString()});return}}n(o)},l)},set:function(m,n,o,l){if(n===undefined){n="undefined"}else{n=JSON.stringify(n)}g.priv.call("prefs.set",{key:m.toString(),value:n},o,l)},keys:function(m,l){g.priv.call("prefs.keys",{},m,l)},all:function(m,l){var m=m&&function(n){for(key in n){if(n[key]==="undefined"){n[key]=undefined}else{n[key]=JSON.parse(n[key])}}m(n)};g.priv.call("prefs.all",{},m,l)},clear:function(m,n,l){g.priv.call("prefs.clear",{key:m.toString()},n,l)},clearAll:function(m,l){g.priv.call("prefs.clearAll",{},m,l)}};j.file={getImage:function(m,l){g.priv.call("file.getImage",{},function(n){m&&m({uri:n,name:"Image"})},l)},base64:function(m,n,l){g.priv.call("file.base64",m,n,l)},imageBase64:function(m,n,o,l){if(typeof n==="function"){l=o;o=n}n=n||{};n.height=n.height||0;n.width=n.width||0;g.priv.call("file.imageBase64",{file:m,props:n},o,l)},imageURL:function(m,n,o,l){if(typeof n==="function"){l=o;o=n}if(m.uri){o(m.uri)}else{l()}},isImage:function(m,n,l){g.priv.call("file.isImage",m,n,l)},isFile:function(m,n,l){g.priv.call("file.isFile",m,n,l)}};j.event={menuPressed:{addListener:function(m,l){if(g.listeners.menuPressed){g.listeners.menuPressed.push(m)}else{g.listeners.menuPressed=[m]}}}};j.contact={select:function(m,l){g.priv.call("contact.select",{},m,l)}};g.priv.send=function(m){if(window.__forge["callJavaFromJavaScript"]===undefined){return}var l=((m.params!==undefined)?JSON.stringify(m.params):"");window.__forge["callJavaFromJavaScript"](m.callid,m.method,l)};g.priv.get=function(){var l=JSON.parse(window.__forge["getObjects"]());l.forEach(function(m){g.priv.receive(m)})};j.is.mobile=function(){return true};j.is.android=function(){return true};j.tools.getURL=function(n,l,m){n=n.toString();if(n.indexOf("http://")===0||n.indexOf("https://")===0){l(n)}else{l("file:///android_asset/src"+((n.indexOf("/")===0)?n:("/"+n)))}};j.request.ajax=function(A){var n=(A.files?A.files:null);var o=(A.url?A.url:null);var z=(A.success?A.success:undefined);var u=(A.error?A.error:undefined);var s=(A.username?A.username:null);var y=(A.password?A.password:null);var m=(A.accepts?A.accepts:["*/*"]);var l=(A.cache?A.cache:false);var x=(A.contentType?A.contentType:null);var r=(A.data?A.data:null);var w=(A.dataType?A.dataType:null);var q=(A.headers?A.headers:{});var v=(A.timeout?A.timeout/1000:60);var t=(A.type?A.type:"GET");if(typeof m==="string"){m=[m]}var p=null;if(n){p=j.tools.UUID().replace(/-/g,"");r=g.generateMultipartString(r,p);x="multipart/form-data; boundary="+p}else{if(t=="GET"){o=g.generateURI(o,r);r=null}else{if(r){r=g.generateQueryString(r);if(!x){x="application/x-www-form-urlencoded"}}}}if(l){l={};l["wm"+Math.random()]=Math.random();o=g.generateURI(o,l)}if(m){q.Accept=m.join(",")}if(x){q["Content-Type"]=x}g.priv.call("request.ajax",{url:o,username:s,password:y,data:r,headers:q,timeout:v,type:t,boundary:p,files:n},z&&function(D){try{if(w=="xml"){var C,B;if(window.DOMParser){C=new DOMParser();B=C.parseFromString(D,"text/xml")}else{B=new ActiveXObject("Microsoft.XMLDOM");B.async="false";B.loadXML(D)}D=B}else{if(w=="json"){D=JSON.parse(D)}}}catch(E){}z(D)},u)};window.forge={config:j.config,is:{mobile:j.is.mobile,desktop:j.is.desktop,android:j.is.android,ios:j.is.ios,chrome:j.is.chrome,firefox:j.is.firefox,safari:j.is.safari,ie:j.is.ie},message:{listen:j.message.listen,broadcast:j.message.broadcast,broadcastBackground:j.message.broadcastBackground,toFocussed:j.message.toFocussed},notification:{create:j.notification.create},request:{get:j.request.get,ajax:j.request.ajax},logging:{log:j.logging.log,debug:j.logging.debug,info:j.logging.info,warning:j.logging.warning,error:j.logging.error,critical:j.logging.critical},tabs:{open:j.tabs.open,closeCurrent:j.tabs.closeCurrent},tools:{UUID:j.tools.UUID,getURL:j.tools.getURL},prefs:{get:j.prefs.get,set:j.prefs.set,clear:j.prefs.clear,clearAll:j.prefs.clearAll,keys:j.prefs.keys},button:{setIcon:j.button.setIcon,setURL:j.button.setURL,onClicked:{addListener:j.button.onClicked.addListener},setBadge:j.button.setBadge,setBadgeBackgroundColor:j.button.setBadgeBackgroundColor,setTitle:j.button.setTitle},file:{getImage:j.file.getImage,isFile:j.file.isFile,isImage:j.file.isImage,imageURL:j.file.imageURL,imageBase64:j.file.imageBase64,base64:j.file.base64},event:{menuPressed:{addListener:j.event.menuPressed.addListener}},contact:{select:j.contact.select}};window.forge["ajax"]=j.request.ajax;window.forge["getPage"]=j.request.get;window.forge["createNotification"]=j.notification.create;window.forge["UUID"]=j.tools.UUID;window.forge["getURL"]=j.tools.getURL;window.forge["log"]=j.logging.log;window.forge["button"]["setUrl"]=j.button.setURL;window.forge["button"]["setBadgeText"]=j.button.setBadge;window.forge["_get"]=g.priv.get;window.forge["_receive"]=g.priv.receive;window.forge["_dispatchMessage"]=g.dispatchMessage})();